<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Task Hierarchy</title>
</head>
<body>
    <h1>Task Management - Hierarchy Test</h1>
    <div id="output"></div>

    <script>
        async function testAPI() {
            try {
                console.log('Testing API...');
                const response = await fetch('http://127.0.0.1:8001/api/tasks/all_tasks/');
                const tasks = await response.json();
                
                console.log('Raw API response:', tasks);
                
                const output = document.getElementById('output');
                
                // Filter main tasks and subtasks
                const mainTasks = tasks.filter(task => !task.parent_task);
                const subtasks = tasks.filter(task => task.parent_task);
                
                let html = '<h2>API Response Summary</h2>';
                html += `<p>Total tasks: ${tasks.length}</p>`;
                html += `<p>Main tasks: ${mainTasks.length}</p>`;
                html += `<p>Subtasks: ${subtasks.length}</p>`;
                
                html += '<h3>Hierarchy:</h3>';
                html += '<ul>';
                
                mainTasks.forEach(mainTask => {
                    html += `<li><strong>${mainTask.title}</strong> (ID: ${mainTask.id})`;
                    const taskSubtasks = subtasks.filter(sub => sub.parent_task === mainTask.id);
                    if (taskSubtasks.length > 0) {
                        html += '<ul>';
                        taskSubtasks.forEach(subtask => {
                            html += `<li>${subtask.title} (ID: ${subtask.id}) - ${subtask.progress}%</li>`;
                        });
                        html += '</ul>';
                    }
                    html += '</li>';
                });
                
                html += '</ul>';
                
                // Show what would be sent to GanttChart
                const formattedTasks = tasks.map(task => ({
                    id: task.id,
                    text: task.title,
                    progress: task.progress,
                    parent: task.parent_task || 0,
                    status: task.status
                }));
                
                html += '<h3>Formatted for GanttChart:</h3>';
                html += '<pre>' + JSON.stringify(formattedTasks, null, 2) + '</pre>';
                
                output.innerHTML = html;
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('output').innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }
        
        // Test on page load
        testAPI();
    </script>
</body>
</html>